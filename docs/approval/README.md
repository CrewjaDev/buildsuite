# 承認フロー機能 ドキュメント

## 概要

このディレクトリには、承認フロー機能に関する包括的なドキュメントが含まれています。承認フロー機能は、見積、予算、発注、進捗、支払いなどの業務プロセスにおける承認ワークフローを管理するシステムです。

## ドキュメント構成

### 📋 [実装状況](./implementation-status.md)
承認フロー機能の現在の実装状況を詳細にまとめたドキュメントです。

**内容:**
- 実装状況サマリー
- データベース設計の完成度
- モデル実装の詳細
- GraphQL API の実装状況
- 未実装機能と今後の開発計画

### 🔄 [現状アップデート](./current-status-update.md)
Laravel tinkerでの動作テスト完了を踏まえた最新の実装状況です。

**内容:**
- tinkerテストでの動作確認結果
- 認証ロジックの現在の状態
- 実際の完成度評価（95%）
- 動作確認済みシナリオ

### 🗃️ [データベーススキーマ](./database-schema.md)
承認フロー機能のデータベース設計について詳細に説明したドキュメントです。

**内容:**
- テーブル構成とリレーション
- 各テーブルの詳細仕様
- インデックス戦略
- データ整合性の保証
- 拡張性への配慮

### 🔌 [API リファレンス](./api-reference.md)
GraphQL API の完全なリファレンスドキュメントです。

**内容:**
- GraphQL Types 定義
- Queries の使用方法
- Mutations の実装
- 認証・認可の仕組み
- エラーハンドリング
- 実際の使用例

### 🧪 [テストガイド](./testing-guide.md)
Laravel tinkerとGraphQL APIでの動作テスト方法を詳しく説明したガイドです。

**内容:**
- Laravel tinkerでのテスト手順
- GraphQL APIテスト（/graphql-testエンドポイント）
- 複雑なシナリオテスト
- パフォーマンステスト
- エラーテスト手順

### 🔧 [見積権限設定ガイド](./estimate-permissions-guide.md)
見積機能における詳細な権限設定方法を説明したガイドです。

**内容:**
- 見積基本情報の権限要件
- 利用・登録・編集・削除・承認権限の設定
- 承認フローとの連携方法
- フロントエンド実装提案

### 🎛️ [承認機能詳細権限設定](./approval-permissions-detailed.md)
承認機能の詳細な権限設定と画面設計について説明したガイドです。

**内容:**
- 申請・承認・却下・差戻・委譲の詳細権限
- 承認フロー順序設定と管理
- 詳細権限設定画面の具体的設計例
- 権限マトリックス管理

### 🔄 [統合承認権限設定](./unified-permissions-setting.md)
部署・役職・個人の権限を一画面で統合管理する方法を説明したガイドです。

**内容:**
- 権限継承の階層構造設計
- 統合権限設定画面の設計
- 例外設定と権限継承ビューア
- 効率的な一括設定と個別調整

### 👥 [役割別権限設定](./role-based-permissions.md)
申請専門担当者、承認者、管理者など役割に応じた権限設定ガイドです。

**内容:**
- 申請専門担当者（承認しない担当者）の権限設定
- 承認者・管理者の権限設定
- 部署・役職・役割マトリックス管理
- 役割ベースの権限チェック実装

### 🏢 [階層別承認フロー設定](./hierarchical-approval-flow.md)
組織階層に応じた複雑な承認フローの設定方法を詳しく説明したガイドです。

**内容:**
- 担当者→上長→社長の階層別承認フロー
- 上長が申請者になる場合の動的フロー変更
- 組織階層に基づく権限設定と承認制御
- 階層別承認フロー可視化とテスト機能

### 🎨 [ノーコード承認フロー設計画面](./no-code-flow-designer.md)
プログラミング知識不要で承認フローを視覚的に設計・設定できる画面仕様です。

**内容:**
- ドラッグ&ドロップによる直感的フロー設計
- リアルタイムプレビューとテストシミュレーション
- テンプレート機能と設定の再利用
- ビジュアル設計から実行可能フローへの自動変換

### 📊 [ノーコード設計対応範囲](./no-code-design-coverage.md)
承認フローの代表的な運用パターンとノーコード設計での対応範囲を整理したガイドです。

**内容:**
- 承認フローの代表的な運用パターン分析
- ノーコード設計で対応可能な機能範囲
- カスタム実装が必要な部分の明確化

### 🖥️ [ノーコード設計画面最終仕様](./approval-implementation/no-code-designer-final-spec.md)
ノーコード承認フロー設計画面の最終的な画面設計・機能設計・実装仕様書です。

**内容:**
- 詳細な画面設計（レイアウト・UI・UX）
- 包括的な機能設計（コア機能・テンプレート・テスト）
- 現在の実装との適合性分析
- 実装難易度・工数見積もり・推奨事項
- 業務別対応パターンと実装優先度

### 🚀 [Phase 1: 統合アプリケーション実装戦略](./approval-implementation/phase1-integration-strategy.md)
承認フロー設計機能をBuildSuiteに統合する具体的な実装戦略とスケジュールです。

**内容:**
- 統合アプリケーション構成の詳細設計
- Vue.js + React のフロントエンド統合戦略
- GraphQL API・データベース・認証の拡張方針
- 16週間の詳細実装スケジュール
- 成功指標・評価基準・次フェーズへの移行判断

## 機能概要

### 🔄 承認フロー管理
- **フロー設定**: 業務タイプ別の承認ルートを定義
- **ステップ管理**: 承認者、順序、条件を詳細に設定
- **条件設定**: 金額、部署、役割などの複雑な適用条件

### 📝 承認プロセス
- **承認依頼**: 自動的な承認フロー選択と依頼作成
- **承認処理**: 承認、却下、差し戻し、キャンセル
- **進捗管理**: リアルタイムでの承認状況追跡

### 📊 履歴管理
- **完全な監査ログ**: 全ての承認操作を記録
- **コメント機能**: 承認時の詳細な理由記録
- **委譲機能**: 承認権限の一時的な委譲

## 技術スタック

### バックエンド
- **Framework**: Laravel 10
- **Database**: MySQL 8.0
- **API**: GraphQL (Lighthouse)
- **Authentication**: Laravel Sanctum

### 主要な技術的特徴
- **柔軟な設計**: 様々な業務プロセスに対応
- **高いパフォーマンス**: 最適化されたクエリとインデックス
- **セキュリティ**: 詳細な権限管理とアクセス制御
- **拡張性**: 新しい要件に容易に対応可能

## アーキテクチャ

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   GraphQL API   │    │   Database      │
│                 │    │                 │    │                 │
│ - React         │◄──►│ - Queries       │◄──►│ - approval_*    │
│ - TypeScript    │    │ - Mutations     │    │   tables        │
│ - Apollo Client │    │ - Types         │    │ - Indexes       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │   Models        │
                       │                 │
                       │ - ApprovalFlow  │
                       │ - ApprovalStep  │
                       │ - ApprovalReq.. │
                       │ - ApprovalHist. │
                       └─────────────────┘
```

## 使用例

### 見積承認フローの例

1. **フロー設定**
   ```
   見積承認フロー（100万円以上）
   ├── 条件: 金額 >= 1,000,000円
   ├── ステップ1: 部長承認
   ├── ステップ2: 役員承認
   └── ステップ3: 社長承認
   ```

2. **承認プロセス**
   ```
   依頼作成 → 部長承認 → 役員承認 → 社長承認 → 完了
   ```

3. **履歴記録**
   ```
   2024-01-15 10:00 - 田中さんが承認依頼を作成
   2024-01-15 14:30 - 佐藤部長が承認
   2024-01-16 09:15 - 山田役員が承認
   2024-01-16 16:45 - 鈴木社長が承認 → 完了
   ```

## 開発ガイドライン

### コーディング規約
- Laravel の標準的な規約に従う
- GraphQL のベストプラクティスを適用
- 適切なコメントとドキュメント化

### テスト戦略
- 単体テスト: モデルとビジネスロジック
- 統合テスト: GraphQL API エンドポイント
- E2Eテスト: 承認フロー全体のワークフロー

### セキュリティ
- 認証・認可の徹底
- SQL インジェクション対策
- XSS 対策
- CSRF 対策

## 今後の開発計画

### Phase 1: フロントエンド実装
- [ ] 承認フロー管理画面
- [ ] 承認依頼作成・管理画面
- [ ] 承認処理画面
- [ ] ダッシュボード

### Phase 2: 機能拡張
- [ ] 通知システム（メール・プッシュ）
- [ ] レポート・分析機能
- [ ] モバイルアプリ対応
- [ ] 外部システム連携

### Phase 3: 最適化
- [ ] パフォーマンス改善
- [ ] キャッシュ機能
- [ ] 監視・ログ機能
- [ ] 負荷分散対応

## 関連リンク

- [ビジネス機能仕様書](../business-functions.md)
- [GraphQL 使用ガイド](../graphql-usage-guide.md)
- [データベース設計書](../database-design/)
- [権限管理ドキュメント](../permission/)

## サポート

承認フロー機能に関するご質問やサポートが必要な場合は、開発チームまでお問い合わせください。

---

*最終更新日: 2024年1月*
