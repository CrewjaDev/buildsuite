# ユーザー管理ページ実装タスク管理

## プロジェクト概要
- **プロジェクト名**: BuildSuite ユーザー管理機能
- **実装期間**: 約10-12日
- **技術スタック**: Next.js 14 + TanStack Table + Shadcn/ui + Laravel API
- **担当者**: 開発チーム

## 実装計画

### Phase 1: 基盤構築（1-2日）
**目標**: 基本的なユーザー管理機能の動作確認

#### 1.1 依存関係のインストール
- [x] TanStack Table と React Query のインストール
- [x] Shadcn/uiコンポーネントの追加（shadcn@latest使用）
- [x] sonnerコンポーネントの追加（toastの代替）
- [x] components.jsonファイル作成
- [ ] インストール確認と動作テスト

#### 1.2 基本ファイル構造の作成
- [x] `lib/userService.ts` - ユーザーAPIサービス
- [x] `lib/types.ts` - 共通型定義
- [x] `hooks/useUsers.ts` - ユーザー管理フック
- [x] `components/ui/` - Shadcn/uiコンポーネント
- [x] `components/common/data-display/DataTable/` - 汎用テーブル
- [x] `app/(management)/users/page.tsx` - ユーザー一覧ページ

#### 1.3 実装順序
1. [ ] ユーザーサービス (`lib/userService.ts`)
2. [ ] 型定義 (`lib/types.ts`)
3. [ ] React Queryフック (`hooks/useUsers.ts`)
4. [ ] 基本UIコンポーネント (`components/ui/`)
5. [ ] 汎用データテーブル (`components/common/data-display/DataTable/`)
6. [ ] ユーザー管理ページ (`app/(management)/users/page.tsx`)

**Phase 1 完了条件**: ユーザー一覧が表示され、基本的なAPI通信が動作すること

---

### Phase 2: 基本機能実装（2-3日）
**目標**: ユーザー一覧表示、検索、フィルター、ページネーション

#### 2.1 実装する機能
- [x] ユーザー一覧表示（スティッキーヘッダー）
- [x] 検索機能（名前、メール、社員ID）
- [x] フィルター機能（ステータス、システムレベル）
- [x] ページネーション
- [x] 列移動機能
- [ ] 列幅調整（課題：TanStack Table v8での実装方法調査が必要）
- [x] レスポンシブ対応

#### 2.2 実装順序
1. [ ] ユーザーテーブルコンポーネント (`components/features/users/components/UserTable/`)
2. [ ] 検索・フィルターコンポーネント (`components/features/users/components/SearchFilters/`)
3. [ ] ページネーションコンポーネント (`components/common/data-display/PaginationControls/`)
4. [ ] メインページ統合

**Phase 2 完了条件**: 検索、フィルター、ページネーションが正常に動作すること

---

### Phase 3: 詳細機能実装（2-3日）
**目標**: ユーザー詳細、編集、作成、削除機能

#### 3.1 実装する機能
- [ ] ユーザー詳細表示（照会・編集タブ方式）
- [ ] ユーザー編集
- [ ] ユーザー作成
- [ ] ユーザー削除
- [ ] 役割・部署の割り当て

#### 3.2 ユーザー詳細ページ実装順序
1. [x] 詳細ページ基本レイアウト (`app/(management)/users/[id]/page.tsx`)
2. [x] データ取得フック (`app/(management)/users/[id]/hooks/useUserDetail.ts`)
3. [x] 照会モードコンポーネント (`components/features/users/UserDetail/UserDetailView.tsx`)
4. [x] 編集モードコンポーネント (`components/features/users/UserDetail/UserDetailEdit.tsx`)
5. [x] 情報カードコンポーネント群
   - [x] 基本情報カード (`UserInfoCard.tsx`)
   - [x] 所属情報カード (`UserDepartmentCard.tsx`)
   - [x] 権限・役割カード (`UserRoleCard.tsx`)
   - [x] 履歴カード (`UserHistoryCard.tsx`)
6. [x] ヘッダーコンポーネント (`UserDetailHeader.tsx`)
7. [x] タブ切り替え機能の実装
8. [ ] 権限管理の実装

#### 3.3 その他の実装順序
9. [ ] ユーザーフォームコンポーネント (`components/features/users/components/UserForm/`)
10. [ ] ダイアログコンポーネント (`components/features/users/components/UserDialog/`)
11. [ ] ページ統合

**Phase 3 完了条件**: ユーザー詳細ページの照会・編集機能が正常に動作すること

---

### Phase 4: 高度な機能実装（2-3日）
**目標**: 権限管理、バッチ操作、エクスポート機能

#### 4.1 実装する機能
- [ ] 権限チェック
- [ ] バッチ操作（一括削除、一括ステータス変更）
- [ ] エクスポート機能（CSV、Excel）
- [ ] 操作ログ
- [ ] 通知機能

**Phase 4 完了条件**: 高度な機能が正常に動作すること

---

### Phase 5: 最適化・テスト（1-2日）
**目標**: パフォーマンス最適化、テスト、ドキュメント

#### 5.1 実装する項目
- [ ] パフォーマンス最適化
- [ ] エラーハンドリング
- [ ] アクセシビリティ対応
- [ ] テスト実装
- [ ] ドキュメント作成

**Phase 5 完了条件**: 本番環境での運用に耐える品質であること

---

## 進捗管理

### 現在の状況
- **開始日**: 2024年8月28日
- **現在のPhase**: Phase 3（ユーザー詳細ページ実装）
- **完了率**: Phase 1: 100%, Phase 2: 100%, Phase 3: 40%

### 進捗ログ

#### 2024年8月28日 - Phase 3開始（ユーザー詳細ページ実装）
- ✅ ユーザー詳細ページ設計仕様の策定完了
- ✅ タブ方式（照会・編集統合）の設計決定
- ✅ 基本履歴情報の定義完了
- ✅ ファイル構成の設計完了
- ✅ 詳細ページ基本レイアウトの実装完了
- ✅ Tabsコンポーネントのインストール完了
- ✅ データ取得フックの実装完了
- ✅ 詳細なユーザー情報の型定義完了
- ✅ 照会モードコンポーネントの実装完了
- ✅ 機能別配置（features/users/UserDetail/）に統一
- ✅ タブ切り替え機能実装完了
- ✅ hooks配置の整理完了（機能別配置に統一）
- ✅ 編集モードコンポーネントの実装完了
- ✅ Labelコンポーネントのインストール完了
- ✅ メインページへの編集コンポーネント統合完了
- ✅ zodと@hookform/resolversのインストール完了
- ✅ 情報カードコンポーネント群の実装完了
  - ✅ 基本情報カード (`UserInfoCard.tsx`)
  - ✅ 所属情報カード (`UserDepartmentCard.tsx`)
  - ✅ 権限・役割カード (`UserRoleCard.tsx`)
  - ✅ 履歴カード (`UserHistoryCard.tsx`)
- ✅ UserDetailViewのリファクタリング完了（カードコンポーネント分離）
- ✅ 編集モードに権限・役割編集機能を追加完了
- ✅ 照会・編集モードの項目統一完了
  - ✅ 連絡先情報カード (`UserContactCard.tsx`) の作成
  - ✅ 照会モードの項目構成を編集モードと統一
  - ✅ 基本情報カードから連絡先情報を分離
- ✅ システム権限レベルの動的選択肢対応完了
  - ✅ バックエンドでsystem_level_infoを含める実装確認
  - ✅ ユーザー編集用オプションデータ取得APIの実装
  - ✅ useUserOptionsフックの作成
  - ✅ 編集モードで動的なシステム権限レベル・職位選択を実装
  - ✅ マスタ管理ページでの設定変更に対応可能な完全な動的設計
- ✅ ヘッダーコンポーネントの実装完了
  - ✅ UserDetailHeaderコンポーネントの作成
  - ✅ ユーザー基本情報表示、ナビゲーション、アクションボタン
  - ✅ 編集、削除、アカウントロック、パスワードリセット機能
  - ✅ 権限に基づくボタン表示制御
  - ✅ dropdown-menuコンポーネントのインストール
  - ✅ メインページへの統合完了
- ✅ 一覧ページから詳細ページへの遷移実装完了
  - ✅ 行クリックで詳細ページに遷移
  - ✅ 編集ボタンで詳細ページの編集モードに遷移
  - ✅ useRouterを使用したページ遷移の実装
- ✅ ユーザー詳細ページの更新機能実装完了
  - ✅ バックエンドのupdateメソッド拡張（新しいフィールド対応）
  - ✅ フロントエンドのフォーム送信処理
  - ✅ 成功・エラーメッセージの表示
  - ✅ 更新後の自動タブ切り替え
- ✅ トースト通知システムの実装完了
  - ✅ カスタムトーストコンポーネントの作成
  - ✅ アニメーション付きの通知表示
  - ✅ 成功・エラー・警告・情報の4種類の通知タイプ
  - ✅ 自動消去機能（設定可能な表示時間）
  - ✅ ユーザー更新・削除・ロック・パスワードリセットでの使用
- ✅ パスワード設定タブの実装完了
  - ✅ UserPasswordCardコンポーネントの作成
  - ✅ パスワード変更機能（現在のパスワード確認付き）
  - ✅ パスワードリセット機能（メール送信）
  - ✅ バリデーション機能（パスワード確認、最小文字数）
  - ✅ ヘッダーコンポーネントからのパスワードリセット機能削除
  - ✅ タブ構成: 照会・編集・パスワード設定
- 🎯 **次のアクション**: 権限管理の実装開始

#### 2024年8月28日 - Phase 2完了
- ✅ ユーザー一覧表示機能の完全実装
- ✅ 検索、フィルター、ページネーション機能実装
- ✅ 列移動機能実装
- ✅ レスポンシブ対応実装
- ✅ データベース設計の最適化（positionsテーブル追加）
- ✅ 職位データの正しい表示実装
- ⚠️ **課題**: 列幅調整機能が動作しない（TanStack Table v8での実装方法の調査が必要）

#### 2024年8月28日 - Phase 1完了
- ✅ 汎用データテーブルコンポーネントの実装完了
- ✅ ユーザー管理ページの実装完了
- ✅ 基本的なユーザー一覧表示機能が動作
- ✅ 検索、フィルター、ページネーション機能実装
- ✅ スティッキーヘッダー、列移動機能実装
- ⚠️ **課題**: 列幅調整機能が動作しない（TanStack Table v8での実装方法の調査が必要）

#### 2024年12月19日 Phase 1 開始
- **実施内容**: タスク管理ファイル作成、実装計画策定、依存関係インストール開始
- **完了項目**: プロジェクト計画策定、TanStack Table/React Queryインストール、Shadcn/uiコンポーネント追加
- **課題・問題**: shadcn-uiがdeprecated、toastコンポーネントもdeprecated、sonnerコンポーネントに移行が必要
- **次のアクション**: sonnerコンポーネントを追加してインストール完了

#### [日付] Phase 1 完了
- **実施内容**: 
- **完了項目**: 
- **課題・問題**: 
- **次のアクション**: 

---

## 技術仕様

### 使用技術
- **フロントエンド**: Next.js 14 (App Router)
- **UIライブラリ**: TanStack Table + Shadcn/ui
- **状態管理**: TanStack Query + Redux Toolkit
- **バックエンド**: Laravel API
- **データベース**: PostgreSQL

### ファイル構成
```
frontend/src/
├── lib/
│   ├── userService.ts          # ユーザーAPIサービス
│   └── types.ts               # 共通型定義
├── hooks/
│   └── useUsers.ts            # ユーザー管理フック
├── components/
│   ├── ui/                    # Shadcn/uiコンポーネント
│   ├── common/
│   │   └── data-display/
│   │       └── DataTable/     # 汎用テーブル
│   └── features/
│       └── users/             # ユーザー管理機能
└── app/
    └── (management)/
        └── users/
            └── page.tsx       # ユーザー一覧ページ
```

### API仕様
- **エンドポイント**: `/api/users`
- **認証**: Laravel Sanctum
- **レスポンス形式**: JSON
- **ページネーション**: サーバーサイド

---

## 品質基準

### 機能要件
- [ ] ユーザー一覧表示
- [ ] 検索・フィルター機能
- [ ] ページネーション
- [ ] CRUD操作
- [ ] 権限管理
- [ ] レスポンシブ対応

### 非機能要件
- [ ] パフォーマンス（1000件以上のデータでスムーズな表示）
- [ ] アクセシビリティ（WCAG 2.1 AA準拠）
- [ ] セキュリティ（認証・認可の適切な実装）
- [ ] 保守性（コンポーネントの再利用性）

### テスト要件
- [ ] ユニットテスト（Jest + React Testing Library）
- [ ] 統合テスト（API連携）
- [ ] E2Eテスト（Cypress）
- [ ] パフォーマンステスト

---

## リスク管理

### 技術リスク
- **リスク**: TanStack Tableの学習コスト
- **対策**: 段階的な実装とドキュメント作成
- **担当者**: 開発チーム

- **リスク**: Laravel APIとの連携問題
- **対策**: 事前のAPI仕様確認とテスト
- **担当者**: 開発チーム

- **リスク**: 列幅調整機能の実装問題
- **対策**: TanStack Table v8の公式ドキュメント確認と代替実装方法の調査
- **担当者**: 開発チーム

### スケジュールリスク
- **リスク**: 機能追加によるスケジュール遅延
- **対策**: 優先度の明確化と段階的リリース
- **担当者**: プロジェクトマネージャー

---

## コミュニケーション

### 進捗報告
- **頻度**: 各Phase完了時
- **方法**: このMarkdownファイルの更新
- **内容**: 完了項目、課題、次のアクション

### 課題管理
- **方法**: GitHub Issues
- **ラベル**: `user-management`, `frontend`, `implementation`
- **優先度**: High, Medium, Low

---

## 完了チェックリスト

### Phase 1 完了チェック
- [ ] 依存関係のインストール完了
- [ ] 基本ファイル構造の作成完了
- [ ] ユーザー一覧の表示確認
- [ ] API通信の動作確認
- [ ] エラーがないことの確認

### Phase 2 完了チェック
- [ ] 検索機能の動作確認
- [ ] フィルター機能の動作確認
- [ ] ページネーションの動作確認
- [ ] レスポンシブ対応の確認
- [ ] パフォーマンスの確認

### Phase 3 完了チェック
- [ ] ユーザー詳細ページの基本レイアウト実装完了
- [ ] データ取得フックの実装完了
- [ ] 照会モードの実装完了
- [ ] 編集モードの実装完了
- [ ] 情報カードコンポーネント群の実装完了
- [ ] タブ切り替え機能の実装完了
- [ ] 権限管理の実装完了
- [ ] レスポンシブ対応の確認
- [ ] ユーザー作成の動作確認
- [ ] ユーザー削除の動作確認
- [ ] 役割・部署割り当ての動作確認
- [ ] バリデーションの確認

### Phase 4 完了チェック
- [ ] 権限チェックの動作確認
- [ ] バッチ操作の動作確認
- [ ] エクスポート機能の動作確認
- [ ] 操作ログの確認
- [ ] 通知機能の動作確認

### Phase 5 完了チェック
- [ ] パフォーマンス最適化の確認
- [ ] エラーハンドリングの確認
- [ ] アクセシビリティの確認
- [ ] テストの実行確認
- [ ] ドキュメントの完成確認

---

## 最終成果物

### 実装成果物
- [ ] ユーザー管理ページ（完全動作版）
- [ ] 再利用可能なコンポーネント群
- [ ] APIサービス層
- [ ] 型定義ファイル群

### ドキュメント成果物
- [ ] 実装ドキュメント
- [ ] API仕様書
- [ ] コンポーネント仕様書
- [ ] 運用マニュアル

### テスト成果物
- [ ] ユニットテスト
- [ ] 統合テスト
- [ ] E2Eテスト
- [ ] パフォーマンステスト結果

---

**最終更新日**: 2024年12月19日
**更新者**: 開発チーム
**次回更新予定**: 2024年12月20日
