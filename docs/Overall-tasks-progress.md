# BuildSuiteシステム 開発全体タスク・進捗管理

## プロジェクト概要
- **プロジェクト名**: BuildSuite 建設業向け業務システム
- **開始日**: 2025年8月28日
- **予定期間**: 約14-17週間
- **技術スタック**: Next.js 14 + Laravel 12 + PostgreSQL + GraphQL

## 現在の状況
- **基盤環境**: ✅ 完了（Docker、Nginx、PostgreSQL、Laravel、Next.js）
- **認証システム**: ✅ 完了（Laravel Sanctum、ログイン・ログアウト）
- **ユーザー管理機能**: ✅ 完了（ユーザーCRUD、権限管理、プロフィール編集）
- **承認フロー基盤**: ✅ 完了（データベース、モデル、GraphQL API基盤）
- **見積管理機能**: 🔄 業務要件・テーブル設計進行中

---

## Phase 0: 基盤環境構築（完了済み）

### 0.1 開発環境構築
**状況**: ✅ 完了  
**完了日**: 2025年8月28日

#### 完了タスク
- [x] **Docker環境構築**
  - [x] Docker Compose設定
  - [x] コンテナ構成（Laravel、Next.js、PostgreSQL、Nginx）
  - [x] ネットワーク設定

- [x] **バックエンド環境**
  - [x] Laravel 12 インストール・設定
  - [x] PostgreSQL 15+ 設定
  - [x] データベース接続設定
  - [x] 環境変数設定

- [x] **フロントエンド環境**
  - [x] Next.js 14 インストール・設定
  - [x] TypeScript設定
  - [x] 開発サーバー設定
  - [x] 環境変数設定

- [x] **Webサーバー設定**
  - [x] Nginx設定（リバースプロキシ）
  - [x] SSL証明書設定
  - [x] 静的ファイル配信設定

### 0.2 認証システム構築
**状況**: ✅ 完了  
**完了日**: 2025年8月28日

#### 完了タスク
- [x] **Laravel Sanctum設定**
  - [x] Sanctumインストール・設定
  - [x] API認証設定
  - [x] CORS設定

- [x] **認証機能実装**
  - [x] ログイン機能
  - [x] ログアウト機能
  - [x] ユーザー認証ミドルウェア
  - [x] パスワードハッシュ化

- [x] **フロントエンド認証**
  - [x] ログインフォーム
  - [x] 認証状態管理
  - [x] 認証ガード設定

### 0.3 データベース設計・構築
**状況**: ✅ 完了  
**完了日**: 2025年8月28日

#### 完了タスク
- [x] **マスタテーブル設計**
  - [x] ユーザー管理テーブル（users、roles、departments等）
  - [x] システム権限テーブル（system_levels、permissions等）
  - [x] 職位マスタテーブル（positions）
  - [x] 工事種別マスタテーブル（project_types）
  - [x] 工事分類マスタテーブル（construction_classifications）

- [x] **承認フローテーブル設計**
  - [x] 承認フローテーブル（approval_flows）
  - [x] 承認ステップテーブル（approval_steps）
  - [x] 承認条件テーブル（approval_conditions）
  - [x] 承認依頼テーブル（approval_requests）
  - [x] 承認履歴テーブル（approval_histories）

- [x] **マイグレーション実行**
  - [x] 全テーブルのマイグレーション
  - [x] シーダーデータ投入
  - [x] インデックス設定

---
### 0.4 ユーザー管理機能実装
**状況**: ✅ 完了  
**完了日**: 2025年8月28日

#### 完了タスク
- [x] **ユーザーCRUD機能**
  - [x] ユーザー登録機能
  - [x] ユーザー情報編集
  - [x] ユーザー削除機能
  - [x] ユーザー一覧表示

- [x] **権限管理機能**
  - [x] ロール設定機能
  - [x] 部署設定機能
  - [x] システム権限設定
  - [x] アクセス制御実装

- [x] **ユーザー情報管理**
  - [x] プロフィール編集
  - [x] パスワード変更
  - [x] アカウントロック機能
  - [x] ログイン履歴管理

### 0.5 承認フロー基盤構築
**状況**: ✅ 完了  
**完了日**: 2025年8月28日

#### 完了タスク
- [x] **データベース・モデル実装**
  - [x] 承認フローモデル作成
  - [x] リレーション設定
  - [x] バリデーション実装
  - [x] テストデータ作成

- [x] **GraphQL API基盤**
  - [x] スキーマ定義
  - [x] 基本クエリ実装
  - [x] 型定義作成
  - [x] エラーハンドリング

## Phase 1: 承認フロー基盤の完成（1-2週間）

### 1.1 GraphQL APIの完成
**優先度**: 🔴 最高  
**担当者**: 開発チーム  
**期限**: 2025年9月4日

#### 実装タスク
- [x] **承認フローCRUDのMutation** ✅ 完了
  - [x] `createApprovalFlow` - 承認フロー作成
  - [x] `updateApprovalFlow` - 承認フロー更新
  - [x] `deleteApprovalFlow` - 承認フロー削除
  - [x] `getApprovalFlow` - 承認フロー詳細取得

- [x] **承認依頼CRUDのMutation** ✅ 完了
  - [x] `createApprovalRequest` - 承認依頼作成
  - [x] `updateApprovalRequest` - 承認依頼更新
  - [x] `deleteApprovalRequest` - 承認依頼削除
  - [x] `getApprovalRequest` - 承認依頼詳細取得

- [x] **承認アクションのMutation** ✅ 完了
  - [x] `approveRequest` - 承認実行 ✅
  - [x] `rejectRequest` - 却下実行 ✅
  - [x] `returnRequest` - 差し戻し実行 ✅
  - [x] `cancelRequest` - キャンセル実行 ✅

- [x] **承認フロー検索・フィルター機能** ✅ 完了
  - [x] 条件による承認フロー検索 ✅
  - [x] 承認依頼のフィルタリング ✅
  - [x] 承認者別承認依頼一覧 ✅

#### 進捗状況
- **完了**: 承認依頼一覧取得クエリ（`ApprovalRequestsQuery`）
- **完了**: ユーザー権限詳細取得クエリ（`UserPermissionsQuery`）
- **完了**: 承認フロー型定義（`ApprovalFlowType`、`ApprovalRequestType`）
- **完了**: 承認フローCRUDのMutation実装
  - ✅ `CreateApprovalFlowMutation` - 承認フロー作成
  - ✅ `UpdateApprovalFlowMutation` - 承認フロー更新
  - ✅ `DeleteApprovalFlowMutation` - 承認フロー削除
  - ✅ `GetApprovalFlowMutation` - 承認フロー詳細取得
- **未着手**: 承認アクションのMutation実装

### 1.2 権限チェック機能の統合
**優先度**: 🟡 高  
**担当者**: 開発チーム  
**期限**: 2025年9月4日

#### 実装タスク
- [x] **承認フローと権限管理の連携** ✅ 完了
  - [x] 承認者判定ロジックの統合 ✅
  - [x] 権限チェック機能の実装 ✅
  - [x] 承認フロー権限の検証 ✅

- [x] **承認者判定ロジックの完成** ✅ 完了
  - [x] ユーザー別承認者判定 ✅
  - [x] 役割別承認者判定 ✅
  - [x] 部署別承認者判定 ✅
  - [x] システム権限レベル別承認者判定 ✅

- [x] **権限チェックミドルウェア** ✅ 完了
  - [x] GraphQL権限チェックミドルウェア ✅
  - [x] 承認アクション権限チェック ✅
  - [x] 承認フロー設定権限チェック ✅

#### 進捗状況
- **完了**: ユーザー権限詳細取得クエリ（`UserPermissionsQuery`）
- **完了**: 承認者判定ロジック（`ApprovalStep::getApprovers()`）
- **完了**: 承認条件評価ロジック（`ApprovalCondition::evaluate()`）
- **進行中**: 権限チェックミドルウェア実装

---

## Phase 2: 見積管理機能（3-4週間）

### 2.1 見積基本機能
**優先度**: 🟡 中  
**担当者**: 開発チーム  
**期限**: 2025年9月25日

#### 実装タスク
- [ ] **見積基本情報の作成・編集**
  - [ ] 見積基本情報テーブル設計
  - [ ] 見積基本情報CRUD API
  - [ ] 見積基本情報フロントエンド

- [ ] **見積明細の入力・編集（階層構造対応）**
  - [ ] 見積明細テーブル設計（階層構造）
  - [ ] 見積明細CRUD API
  - [ ] 階層構造管理機能
  - [ ] 見積明細フロントエンド

- [ ] **見積書の保存・読み込み**
  - [ ] 見積書保存機能
  - [ ] 見積書読み込み機能
  - [ ] 見積書バージョン管理

#### 進捗状況
- **完了**: 見積管理機能業務要件書
- **完了**: 見積管理機能詳細仕様書
- **進行中**: 見積テーブル設計
- **未着手**: 見積基本機能実装

### 2.2 見積承認フロー統合
**優先度**: 🟡 中  
**担当者**: 開発チーム  
**期限**: 2025年10月2日

#### 実装タスク
- [ ] **見積承認フローの設定**
  - [ ] 見積承認フロー定義
  - [ ] 見積承認条件設定
  - [ ] 見積承認者設定

- [ ] **見積承認依頼の作成**
  - [ ] 見積承認依頼作成ロジック
  - [ ] 見積承認依頼通知
  - [ ] 見積承認依頼一覧

- [ ] **見積承認プロセスの実行**
  - [ ] 見積承認アクション
  - [ ] 見積承認履歴管理
  - [ ] 見積承認完了処理

#### 進捗状況
- **未着手**: 見積承認フロー統合

### 2.3 見積高度機能
**優先度**: 🟢 低  
**担当者**: 開発チーム  
**期限**: 2025年10月9日

#### 実装タスク
- [ ] **原価計画の作成・管理**
  - [ ] 原価計画テーブル設計
  - [ ] 原価計画CRUD機能
  - [ ] 原価計画比較機能

- [ ] **見積枝番の作成・管理**
  - [ ] 見積枝番テーブル設計
  - [ ] 見積枝番CRUD機能
  - [ ] 見積枝番比較機能

- [ ] **受注申請機能**
  - [ ] 受注申請ロジック
  - [ ] 工事データ連携
  - [ ] 見積ステータス更新

#### 進捗状況
- **未着手**: 見積高度機能実装

---

## Phase 3: 工事管理機能（3-4週間）

### 3.1 工事基本機能
**優先度**: 🟡 中  
**担当者**: 開発チーム  
**期限**: 2025年11月6日

#### 実装タスク
- [ ] **工事データの作成（見積からの連携）**
  - [ ] 工事データテーブル設計
  - [ ] 見積から工事データ連携
  - [ ] 工事データ初期化

- [ ] **工事明細の独立管理**
  - [ ] 工事明細テーブル設計
  - [ ] 工事明細CRUD機能
  - [ ] 工事明細変更履歴

- [ ] **工事進捗管理**
  - [ ] 工事進捗テーブル設計
  - [ ] 工事進捗入力機能
  - [ ] 工事進捗レポート

#### 進捗状況
- **完了**: 工事管理機能業務要件書
- **進行中**: 工事テーブル設計
- **未着手**: 工事基本機能実装

### 3.2 工事承認フロー統合
**優先度**: 🟡 中  
**担当者**: 開発チーム  
**期限**: 2025年11月13日

#### 実装タスク
- [ ] **工事承認フローの設定**
  - [ ] 工事承認フロー定義
  - [ ] 工事承認条件設定
  - [ ] 工事承認者設定

- [ ] **工事承認依頼の作成**
  - [ ] 工事承認依頼作成ロジック
  - [ ] 工事承認依頼通知
  - [ ] 工事承認依頼一覧

- [ ] **工事承認プロセスの実行**
  - [ ] 工事承認アクション
  - [ ] 工事承認履歴管理
  - [ ] 工事承認完了処理

#### 進捗状況
- **未着手**: 工事承認フロー統合

---

## Phase 4: 発注・支払管理機能（3-4週間）

### 4.1 発注管理機能
**優先度**: 🟢 低  
**担当者**: 開発チーム  
**期限**: 2025年12月4日

#### 実装タスク
- [ ] **発注書の作成・編集**
  - [ ] 発注書テーブル設計
  - [ ] 発注書CRUD機能
  - [ ] 発注書テンプレート

- [ ] **発注承認フロー統合**
  - [ ] 発注承認フロー設定
  - [ ] 発注承認依頼作成
  - [ ] 発注承認プロセス実行

- [ ] **発注書出力機能**
  - [ ] 発注書PDF出力
  - [ ] 発注書Excel出力
  - [ ] 発注書プレビュー

#### 進捗状況
- **未着手**: 発注管理機能実装

### 4.2 支払管理機能
**優先度**: 🟢 低  
**担当者**: 開発チーム  
**期限**: 2025年12月11日

#### 実装タスク
- [ ] **支払通知書の作成・編集**
  - [ ] 支払通知書テーブル設計
  - [ ] 支払通知書CRUD機能
  - [ ] 支払通知書テンプレート

- [ ] **支払承認フロー統合**
  - [ ] 支払承認フロー設定
  - [ ] 支払承認依頼作成
  - [ ] 支払承認プロセス実行

- [ ] **支払通知書出力機能**
  - [ ] 支払通知書PDF出力
  - [ ] 支払通知書Excel出力
  - [ ] 支払通知書プレビュー

#### 進捗状況
- **未着手**: 支払管理機能実装

---

## Phase 5: 統合・最適化（2-3週間）

### 5.1 フロントエンド統合
**優先度**: 🟡 中  
**担当者**: 開発チーム  
**期限**: 2025年12月25日

#### 実装タスク
- [ ] **承認フロー設定UI**
  - [ ] 承認フロー設定画面
  - [ ] 承認ステップ設定画面
  - [ ] 承認条件設定画面

- [ ] **承認依頼一覧UI**
  - [ ] 承認依頼一覧画面
  - [ ] 承認依頼詳細画面
  - [ ] 承認依頼検索・フィルター

- [ ] **承認アクションUI**
  - [ ] 承認アクション画面
  - [ ] 承認履歴表示
  - [ ] 承認コメント機能

#### 進捗状況
- **未着手**: フロントエンド統合

### 5.2 通知機能
**優先度**: 🟢 低  
**担当者**: 開発チーム  
**期限**: 2025年12月25日

#### 実装タスク
- [ ] **承認依頼通知**
  - [ ] 承認依頼メール通知
  - [ ] 承認依頼プッシュ通知
  - [ ] 承認依頼通知設定

- [ ] **承認完了通知**
  - [ ] 承認完了メール通知
  - [ ] 承認完了プッシュ通知
  - [ ] 承認完了通知設定

- [ ] **期限切れ通知**
  - [ ] 期限切れメール通知
  - [ ] 期限切れプッシュ通知
  - [ ] 期限切れ通知設定

#### 進捗状況
- **未着手**: 通知機能実装

---

## 全体進捗サマリー

### 進捗率
- **Phase 0**: 100% 完了 ✅
- **Phase 1**: 40% 完了
- **Phase 2**: 10% 完了
- **Phase 3**: 5% 完了
- **Phase 4**: 0% 完了
- **Phase 5**: 0% 完了

### 全体進捗率: 30%

### 完了済み主要機能
- ✅ **開発環境構築**: Docker、Nginx、PostgreSQL、Laravel、Next.js
- ✅ **認証システム**: Laravel Sanctum、ログイン・ログアウト機能
- ✅ **データベース設計**: 全マスタテーブル、承認フローテーブル
- ✅ **ユーザー管理機能**: ユーザーCRUD、権限管理、プロフィール編集
- ✅ **承認フロー基盤**: データベース、モデル、GraphQL API基盤
- ✅ **開発環境構築**: Docker、Nginx、PostgreSQL、Laravel、Next.js
- ✅ **認証システム**: Laravel Sanctum、ログイン・ログアウト機能
- ✅ **データベース設計**: 全マスタテーブル、承認フローテーブル
- ✅ **ユーザー管理機能**: ユーザーCRUD、権限管理（ほぼ完成）
- ✅ **承認フロー基盤**: データベース、モデル、GraphQL API（部分的）

### 次のマイルストーン
- **2025年9月4日**: Phase 1完了（承認フロー基盤完成）
- **2025年9月25日**: Phase 2.1完了（見積基本機能完成）
- **2025年10月2日**: Phase 2.2完了（見積承認フロー統合完成）

### リスク・課題
1. **権限設定要件の整理**: 承認フローと権限管理の連携要件を明確化する必要
2. **見積テーブル設計**: 階層構造を持つ見積明細のテーブル設計を完成させる必要
3. **工事データ連携**: 見積から工事データへの連携仕様を詳細化する必要

### 技術的成果
- **堅牢な基盤**: Docker環境、認証システム、データベース設計が完成
- **承認フロー基盤**: 複雑な承認ロジックを実装済み
- **権限管理システム**: 多層的な権限管理が実装済み
- **GraphQL API**: 効率的なデータ取得APIが構築済み
- **堅牢な基盤**: Docker環境、認証システム、データベース設計が完成
- **承認フロー基盤**: 複雑な承認ロジックを実装済み
- **権限管理システム**: 多層的な権限管理が実装済み
- **GraphQL API**: 効率的なデータ取得APIが構築済み

---

**最終更新日**: 2025年8月28日  
**更新者**: 開発チーム  
**次回更新予定**: 2025年9月4日（Phase 1完了時）
