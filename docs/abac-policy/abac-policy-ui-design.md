# ABACポリシー管理画面操作構想デザイン

## 概要

アクション別ポリシー最小単位テンプレートを活用した、直感的で使いやすいABACポリシー管理画面の設計です。非技術者でも簡単にポリシーを設定できるUI/UXを目指します。

## 画面構成の全体像

### 1. メイン画面レイアウト

```
┌─────────────────────────────────────────────────────────────────┐
│ ABACポリシー管理                                    [ヘルプ] [設定] │
│ データアクセス制御ポリシーの設定を行います                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 📊 ビジネスコード選択                                            │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐              │
│ │ 📊  │ │ 💰  │ │ 🛒  │ │ 🔨  │ │ 📋  │ │ ⚙️  │              │
│ │見積 │ │予算 │ │発注 │ │工事 │ │一般 │ │その他│              │
│ │管理 │ │管理 │ │管理 │ │管理 │ │業務 │ │     │              │
│ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘              │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 🎯 アクション選択                                                │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐                      │
│ │ 👁️  │ │ ✏️  │ │ ✅  │ │ 📤  │ │ 🗑️  │                      │
│ │一覧 │ │編集 │ │承認 │ │出力 │ │削除 │                      │
│ │表示 │ │    │ │    │ │    │ │    │                      │
│ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘                      │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 📋 現在のポリシー一覧                                            │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 見積管理 - 一覧表示 のポリシー                               │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ ✅ 自部署制限ポリシー                    [編集] [削除]   │ │ │
│ │ │    営業部の見積データのみ表示可能                        │ │ │
│ │ │    適用対象: 営業部全員                                 │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ ✅ ステータス制限ポリシー                [編集] [削除]   │ │ │
│ │ │    承認済み・承認依頼中の見積のみ表示                    │ │ │
│ │ │    適用対象: 一般社員                                   │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ [+ 新しいポリシーを作成]                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## ポリシー作成ウィザード

### ステップ1: 基本情報設定

```
┌─────────────────────────────────────────────────────────────────┐
│ 見積管理 - 一覧表示 ポリシー作成                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ●●●○  ← ステップインジケーター                                  │
│                                                                 │
│ 📝 ポリシー基本情報                                              │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ ポリシー名: [自部署制限ポリシー                    ]        │ │
│ │ 説明:      [営業部の見積データのみ表示可能          ]        │ │
│ │ 効果:      [○許可  ○拒否]                                  │ │
│ │ 優先度:    [50] (0-100)                                    │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ 🎯 適用対象設定                                                  │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 付与先タイプ: [部署 ▼]                                      │ │
│ │ 付与先:      [営業部 ▼]                                    │ │
│ │ 有効期間:    [2024/01/01] ～ [無期限]                      │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ [戻る]                                    [次へ: テンプレート選択] │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### ステップ2: テンプレート選択

```
┌─────────────────────────────────────────────────────────────────┐
│ 見積管理 - 一覧表示 ポリシー作成                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ●●○○  ← ステップインジケーター                                  │
│                                                                 │
│ 🧩 制限条件テンプレート選択                                      │
│                                                                 │
│ 📂 カテゴリ: [すべて ▼]  🔍 検索: [テンプレート名で検索    ]    │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 📁 部署・組織関連                                            │ │
│ │ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ │ │
│ │ │ ✅ 自部署制限    │ │ 🔒 特定部署制限  │ │ 🌐 全部署制限    │ │ │
│ │ │ 自分の部署の     │ │ 指定部署の       │ │ 全部署のデータ   │ │ │
│ │ │ データのみ       │ │ データのみ       │ │ にアクセス可能   │ │ │
│ │ │ [選択]          │ │ [選択]          │ │ [選択]          │ │ │
│ │ └─────────────────┘ └─────────────────┘ └─────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 📁 データ属性関連                                            │ │
│ │ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ │ │
│ │ │ 📊 ステータス制限│ │ 💰 金額制限      │ │ 📅 期間制限      │ │ │
│ │ │ 特定ステータス   │ │ 指定金額以下の   │ │ 指定期間内の     │ │ │
│ │ │ のデータのみ     │ │ データのみ       │ │ データのみ       │ │ │
│ │ │ [選択]          │ │ [選択]          │ │ [選択]          │ │ │
│ │ └─────────────────┘ └─────────────────┘ └─────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 📁 作成者・権限関連                                          │ │
│ │ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ │ │
│ │ │ 👤 作成者制限    │ │ 🏢 職位制限      │ │ 🔐 管理者制限    │ │ │
│ │ │ 自分が作成した   │ │ 特定職位以上の   │ │ 管理者のみ       │ │ │
│ │ │ データのみ       │ │ ユーザーのみ     │ │ アクセス可能     │ │ │
│ │ │ [選択]          │ │ [選択]          │ │ [選択]          │ │ │
│ │ └─────────────────┘ └─────────────────┘ └─────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ [戻る]                                    [次へ: 条件設定]      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### ステップ3: 条件設定

```
┌─────────────────────────────────────────────────────────────────┐
│ 見積管理 - 一覧表示 ポリシー作成                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ●●●○  ← ステップインジケーター                                  │
│                                                                 │
│ ⚙️ 選択したテンプレートの条件設定                                │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ ✅ 自部署制限テンプレート                                    │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ 条件: データの部署ID = ユーザーの部署ID                  │ │ │
│ │ │                                                         │ │ │
│ │ │ 📋 設定項目:                                            │ │ │
│ │ │ • 部署IDフィールド: [department_id ▼]                   │ │ │
│ │ │ • 比較方法: [等しい ▼]                                  │ │ │
│ │ │ • ユーザー部署: [自動取得 ▼]                            │ │ │
│ │ │                                                         │ │ │
│ │ │ 💡 説明: ユーザーが所属する部署のデータのみ表示されます   │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ ✅ ステータス制限テンプレート                                │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ 条件: データのステータス IN [承認済み, 承認依頼中]        │ │ │
│ │ │                                                         │ │ │
│ │ │ 📋 設定項目:                                            │ │ │
│ │ │ • ステータスフィールド: [status ▼]                      │ │ │
│ │ │ • 許可ステータス:                                       │ │ │
│ │ │   ☑ 承認済み    ☑ 承認依頼中    ☐ 下書き                │ │ │
│ │ │   ☐ 却下        ☐ キャンセル                            │ │ │
│ │ │                                                         │ │ │
│ │ │ 💡 説明: 承認済みまたは承認依頼中の見積のみ表示されます   │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ [戻る]                                    [次へ: プレビュー]    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### ステップ4: プレビュー・確認

```
┌─────────────────────────────────────────────────────────────────┐
│ 見積管理 - 一覧表示 ポリシー作成                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ●●●●  ← ステップインジケーター                                  │
│                                                                 │
│ 👀 ポリシー設定プレビュー                                        │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 📋 ポリシー概要                                              │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ 名前: 自部署制限ポリシー                                 │ │ │
│ │ │ 説明: 営業部の見積データのみ表示可能                     │ │ │
│ │ │ 効果: 許可                                               │ │ │
│ │ │ 優先度: 50                                               │ │ │
│ │ │ 適用対象: 営業部全員                                     │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ ⚙️ 条件式詳細                                                │ │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ {                                                       │ │ │
│ │ │   "operator": "and",                                    │ │ │
│ │ │   "rules": [                                            │ │ │
│ │ │     {                                                   │ │ │
│ │ │       "field": "data.department_id",                    │ │ │
│ │ │       "operator": "eq",                                 │ │ │
│ │ │       "value": "user.department_id"                     │ │ │
│ │ │     },                                                  │ │ │
│ │ │     {                                                   │ │ │
│ │ │       "field": "data.status",                           │ │ │
│ │ │       "operator": "in",                                 │ │ │
│ │ │       "value": ["承認済み", "承認依頼中"]                │ │ │
│ │ │     }                                                   │ │ │
│ │ │   ]                                                     │ │ │
│ │ │ }                                                       │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ 🧪 テスト実行                                                   │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ テストユーザー: [営業部 - 田中太郎 ▼]                       │ │
│ │ テストデータ:   [見積ID: EST-001 ▼]                        │ │
│ │                                                             │ │
│ │ [テスト実行] → 結果: ✅ アクセス許可                         │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ [戻る]                                    [ポリシーを作成]      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## テンプレート管理画面

### テンプレート一覧・編集

```
┌─────────────────────────────────────────────────────────────────┐
│ ポリシーテンプレート管理                          [+ 新規テンプレート] │
│ 制限条件の最小単位テンプレートを管理します                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 🔍 検索・フィルタ                                                │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 検索: [テンプレート名で検索                    ] [🔍]        │ │
│ │ カテゴリ: [すべて ▼] アクション: [すべて ▼] 状態: [すべて ▼] │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ 📋 テンプレート一覧                                              │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 📁 部署・組織関連                                            │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ ✅ 自部署制限                    [編集] [複製] [削除]   │ │ │
│ │ │    自分の部署のデータのみアクセス可能                    │ │ │
│ │ │    適用アクション: 一覧表示, 編集, 承認                  │ │ │
│ │ │    タグ: #部署制限 #基本制限                            │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ ✅ 特定部署制限                  [編集] [複製] [削除]   │ │ │
│ │ │    指定した部署のデータのみアクセス可能                  │ │ │
│ │ │    適用アクション: 一覧表示, 編集, 承認                  │ │ │
│ │ │    タグ: #部署制限 #管理者向け                          │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 📁 データ属性関連                                            │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ ✅ ステータス制限                [編集] [複製] [削除]   │ │ │
│ │ │    特定ステータスのデータのみアクセス可能                │ │ │
│ │ │    適用アクション: 一覧表示, 編集, 承認                  │ │ │
│ │ │    タグ: #ステータス制限 #業務フロー                    │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ ✅ 金額制限                      [編集] [複製] [削除]   │ │ │
│ │ │    指定金額以下のデータのみアクセス可能                  │ │ │
│ │ │    適用アクション: 承認, 編集                           │ │ │
│ │ │    タグ: #金額制限 #承認フロー                          │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## ポリシー適用状況確認画面

### リアルタイム適用状況

```
┌─────────────────────────────────────────────────────────────────┐
│ ポリシー適用状況確認                                             │
│ 現在のポリシー設定がどのように適用されているかを確認します        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 🎯 確認対象選択                                                  │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ ビジネスコード: [見積管理 ▼] アクション: [一覧表示 ▼]        │ │
│ │ ユーザー:       [営業部 - 田中太郎 ▼]                       │ │
│ │ データ:         [見積ID: EST-001 ▼]                        │ │
│ │                                                             │ │
│ │ [適用状況を確認]                                            │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ 📊 適用結果                                                      │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ ✅ アクセス許可                                              │ │
│ │                                                             │ │
│ │ 📋 適用されたポリシー:                                       │ │
│ │ • 自部署制限ポリシー (優先度: 50)                           │ │
│ │ • ステータス制限ポリシー (優先度: 30)                       │ │
│ │                                                             │ │
│ │ ⚙️ 最終条件式:                                               │ │
│ │ data.department_id = user.department_id AND                 │ │
│ │ data.status IN ('承認済み', '承認依頼中')                    │ │
│ │                                                             │ │
│ │ 🧪 テスト結果:                                               │ │
│ │ • 部署ID一致: ✅ (1 = 1)                                    │ │
│ │ • ステータス一致: ✅ ('承認済み' IN 許可リスト)              │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 操作フローの特徴

### 1. **直感的な操作フロー**
- ビジネスコード → アクション → テンプレート選択 → 条件設定 → 確認
- 各ステップで必要な情報のみを表示
- 前のステップに戻って修正可能

### 2. **テンプレート中心の設計**
- 技術的な条件式を隠蔽
- ビジネス要件に応じたテンプレート選択
- テンプレートの組み合わせで複雑な条件を構築

### 3. **リアルタイム確認機能**
- 設定中の条件式をプレビュー表示
- テスト実行で実際の適用結果を確認
- 適用状況の可視化

### 4. **段階的なカスタマイズ**
- 基本テンプレートから開始
- 必要に応じて詳細設定に進む
- 上級者向けの直接編集も可能

この設計により、非技術者でも直感的にABACポリシーを設定でき、業務要件に応じた柔軟なアクセス制御が実現できます。
